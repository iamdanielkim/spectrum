<html>
  <head>
    <title> {{name}}</title>
    <link href="/style.css" rel="stylesheet" type="text/css">
  </head>

  <body>
    <div id="header">
      <div id="htext">
        Wiki <strong>{{name}}</strong>
      </div>
    </div>
    <div id="left-panel">
      <div id="pages" class="list">
        <ul>
        {{#pages}}
          <li>{{.}}</li>
        {{/pages}}
        </ul>
      </div>
    </div>
    <div id="left">
      <div id="view" class="content">{{{markdown}}}</div>
    </div>
    <div id="editor">{{{content}}}</div>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
    <script src="/javascripts/markdown/showdown.js" type="text/javascript"></script>
    <script src="http://ajaxorg.github.com/ace/build/src/ace.js"></script>
    <script src="http://ajaxorg.github.com/ace/build/src/mode-coffee.js"></script>
    <script src="http://ajaxorg.github.com/ace/build/src/theme-solarized_dark.js"></script>
    <script src="/javascripts/gsh/ace/mode-gherkin-en.js"></script>

    <script src="/javascripts/bcsocket.js"></script>
    <script src="/javascripts/webclient/share.uncompressed.js"></script>
    <script src="/javascripts/webclient/ace.js"></script>
    <script>
window.onload = function() {
  var converter = new Showdown.converter();
  var view = document.getElementById('view');

  var editor = ace.edit("editor");
  editor.setTheme("ace/theme/solarized_dark");
  var GherkinMode = require('ace/mode/gherkin-en').Mode;
  editor.getSession().setMode(new GherkinMode());
  editor.getSession().setTabSize(2);

  editor.setReadOnly(false);
  editor.session.setUseWrapMode(true);
  editor.setShowPrintMargin(true);

  var connection = new sharejs.Connection('/channel');

  connection.open('{{{docName}}}', function(error, doc) {
    if (error) {
      console.error(error);
      return;
    }
    doc.attach_ace(editor);
    editor.setReadOnly(false);

    var render = function() {
      view.innerHTML = converter.makeHtml(doc.snapshot);
    };

    window.doc = doc;

    render();
    doc.on('change', render);
  });
};
    </script>
  </body>
</html>

